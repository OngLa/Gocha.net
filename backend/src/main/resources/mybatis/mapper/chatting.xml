<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kosa.afnica.backend.db.mapper.ChattingMapper">
    <!--  카센터 목록 조회  -->
    <select id="findAllCarcenter" resultType="ChattingResDto">
        SELECT ID, NAME
        FROM MEMBER
        WHERE ROLE = 'ROLE_CARCENTER'
            AND enabled = '1'
    </select>

    <!--  채팅방 Id 찾기  -->
    <select id="findChatroom" parameterType="map" resultType="Long">
        SELECT ID
        FROM CHATTING
        WHERE USER_ID = #{userId} AND CARCENTER_ID = #{carcenterId}
    </select>

    <!--  채팅방 생성  -->
    <insert id="saveChatroom" parameterType="map">
        <selectKey keyProperty="id" resultType="Long" order="BEFORE">
            SELECT CHATTING_SEQ.nextval FROM DUAL
        </selectKey>
        INSERT INTO CHATTING (ID, CREATE_DATE, CARCENTER_ID, USER_ID)
        VALUES (#{id}, #{createDate}, #{carcenterId}, #{userId})
    </insert>

    <!--  해당 채팅방 메세지 찾기  -->
    <select id="findAllMessageByChatroomID" parameterType="Long" resultType="MessageResDto">
        SELECT ID, member_id, send_date, title, content, is_reservation, cardata_id
        FROM MESSAGE
        WHERE CHATTING_ID = #{chattingId}
    </select>

</mapper>