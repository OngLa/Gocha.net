<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kosa.afnica.backend.db.mapper.ReservationMapper">

    <!--#############################################################################################-->
    <!-- 예약하기 insert -->
    
    <insert id="saveReservation" parameterType="ReservationReqDto">
        <selectKey keyProperty="id" resultType="Long" order="BEFORE">
            select RESERVATION_SEQ.nextval from dual
        </selectKey>
        INSERT INTO RESERVATION
        (ID, MEMBER_ID, CARCENTER_ID, RESERVED_DATE, CARDATA_ID)
        VALUES(
        #{id, jdbcType=NUMERIC},
        #{memberId, jdbcType=NUMERIC},
        #{carcenterId, jdbcType=NUMERIC},
        #{reservedDate, jdbcType=TIMESTAMP},
        #{carDataId, jdbcType=NUMERIC}
        )
    </insert>

    <!--###############################################################################################-->
    <!-- 예약목록 select -->
    <select id="findReservationByMemberId" parameterType="Long" resultType="ReservationResDto">
        SELECT A.ID, A.RESERVED_DATE, A.STATE, A.CARDATA_ID, A.CARCENTER_ID, B.NAME AS carcenter_name
        FROM RESERVATION A INNER JOIN MEMBER B ON A.carcenter_id = B.id
        where A.MEMBER_ID = #{memberId}
        order By ID desc
    </select>

    <!-- EMAIL에서 id 추출하는 쿼리 -->
    <select id="findIdByEmail" parameterType="String" resultType="Long">
        SELECT ID
        FROM MEMBER
        where EMAIL = #{email}
    </select>
    <!--#############################################################################################-->
    <!-- 예약목록 delete -->
    
    <delete id="deleteById" parameterType="Long">
        delete
        from reservation
        where id = #{id}
    </delete>
    <!--#############################################################################################-->


</mapper>
